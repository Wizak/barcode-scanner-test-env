<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>–°–∫–∞–Ω–µ—Ä —á–µ—Ä–µ–∑ Bluetooth</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #status { margin-top: 1em; color: green; }
    #error { color: red; }
  </style>
</head>
<body>

<h1>–°–∫–∞–Ω—É–≤–∞–Ω–Ω—è –∑ Bluetooth –°–∫–∞–Ω–µ—Ä–∞</h1>
<button id="connectBtn">üîó –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ —Å–∫–∞–Ω–µ—Ä</button>
<div id="status">–°—Ç–∞–Ω: –ù–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ</div>
<div id="error"></div>

<h2>–û—Ç—Ä–∏–º–∞–Ω—ñ –∫–æ–¥–∏:</h2>
<ul id="scans"></ul>

<script>
  let device, characteristic;

  document.getElementById('connectBtn').addEventListener('click', async () => {
    try {
      if (!navigator.bluetooth) {
        showError("–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î Web Bluetooth API");
        return;
      }

      clearError();
      updateStatus("–û—á—ñ–∫—É–≤–∞–Ω–Ω—è –≤–∏–±–æ—Ä—É –ø—Ä–∏—Å—Ç—Ä–æ—é...");

      // === –ö—Ä–æ–∫ 1: –ó–∞–ø–∏—Ç –ø—Ä–∏—Å—Ç—Ä–æ—é ===
      device = await navigator.bluetooth.requestDevice({
        filters: [
          { namePrefix: 'YourScanner' } // üîÑ –ó–∞–º—ñ–Ω–∏—Ç–∏ –Ω–∞ –Ω–∞–∑–≤—É –≤–∞—à–æ–≥–æ —Å–∫–∞–Ω–µ—Ä–∞
          // –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π services: ['your-service-uuid']
        ],
        optionalServices: ['battery_service', 'device_information'] // –¥–æ–¥–∞–π UUID —Å–∫–∞–Ω–µ—Ä–∞, —è–∫—â–æ –≤—ñ–¥–æ–º–æ
      });

      updateStatus(`–û–±—Ä–∞–Ω–æ –ø—Ä–∏—Å—Ç—Ä—ñ–π: ${device.name}`);

      // === –ö—Ä–æ–∫ 2: –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è ===
      const server = await device.gatt.connect();
      updateStatus("–ü—ñ–¥–∫–ª—é—á–µ–Ω–æ. –ß–∏—Ç–∞–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å—ñ–≤...");

      // === –ö—Ä–æ–∫ 3: –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å—É —Ç–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ ===
      const service = await server.getPrimaryService('your-service-uuid'); // ‚Üê –∑–∞–º—ñ–Ω–∏ –Ω–∞ —Å–ø—Ä–∞–≤–∂–Ω—ñ–π UUID
      characteristic = await service.getCharacteristic('your-characteristic-uuid'); // ‚Üê –∑–∞–º—ñ–Ω–∏

      updateStatus("–û—á—ñ–∫—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –≤—ñ–¥ —Å–∫–∞–Ω–µ—Ä–∞...");

      // === –ö—Ä–æ–∫ 4: –ü—ñ–¥–ø–∏—Å–∫–∞ –Ω–∞ –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó ===
      await characteristic.startNotifications();
      characteristic.addEventListener('characteristicvaluechanged', handleScan);

    } catch (err) {
      console.error(err);
      showError("–ü–æ–º–∏–ª–∫–∞: " + err.message);
    }
  });

  function handleScan(event) {
    const value = event.target.value;
    const decoder = new TextDecoder('utf-8');
    const code = decoder.decode(value);

    const li = document.createElement('li');
    li.textContent = code;
    document.getElementById('scans').appendChild(li);
  }

  function updateStatus(msg) {
    document.getElementById('status').textContent = "–°—Ç–∞–Ω: " + msg;
  }

  function showError(msg) {
    document.getElementById('error').textContent = msg;
  }

  function clearError() {
    document.getElementById('error').textContent = '';
  }
</script>

</body>
</html>
